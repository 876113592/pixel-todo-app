name: Claude Code - pixel-todo-app

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  issues:
    types: [opened, assigned]
  pull_request_review:
    types: [submitted]

jobs:
  claude:
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review' && contains(github.event.review.body, '@claude')) ||
      (github.event_name == 'issues' && (contains(github.event.issue.body, '@claude') || contains(github.event.issue.title, '@claude')))
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      issues: write
      id-token: write
      actions: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          fetch-depth: 1

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run Claude Code
        id: claude
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}

          # é’ˆå¯¹åƒç´ é£æ ¼ PWA å¾…åŠäº‹é¡¹åº”ç”¨çš„ä¼˜åŒ–é…ç½®
          claude_args: |
            --model claude-3-haiku-20240307
            --max-turns 8
            --allowedTools "Bash(python*),Bash(pip*),Bash(npm*),Bash(node*),Read,Write,Edit,Glob,Grep"
            --system-prompt "ä½ æ˜¯ pixel-todo-app çš„å¼€å‘åŠ©æ‰‹ã€‚è¿™æ˜¯ä¸€ä¸ªåƒç´ é£æ ¼çš„ PWA å¾…åŠäº‹é¡¹åº”ç”¨ï¼Œå…·æœ‰ä»¥ä¸‹æŠ€æœ¯æ ˆï¼š

ğŸ¯ é¡¹ç›®æ¶æ„ï¼š
- å‰ç«¯ï¼šHTML5 + CSS3 + Vanilla JavaScript (PWA)
- åç«¯ï¼šPython Flask API
- æ•°æ®åº“ï¼šSQLite (ç®€å•éƒ¨ç½²)
- éƒ¨ç½²ï¼šRender (åç«¯) + Vercel (å‰ç«¯)
- ç‰¹æ€§ï¼šService Workerã€ç¦»çº¿æ”¯æŒã€åƒç´ é£æ ¼è®¾è®¡

ğŸ“ é¡¹ç›®ç»“æ„ï¼š
- frontend/ï¼šPWA å‰ç«¯åº”ç”¨
  - index.htmlï¼šä¸»é¡µé¢
  - css/ï¼šåƒç´ é£æ ¼æ ·å¼
  - js/ï¼šJavaScript é€»è¾‘
  - sw.jsï¼šService Worker
  - manifest.jsonï¼šPWA é…ç½®
- backend/ï¼šFlask API åç«¯
- main.pyï¼šFlask åº”ç”¨å…¥å£
- requirements.txtï¼šPython ä¾èµ–

ğŸ¨ è®¾è®¡åŸåˆ™ï¼š
- ä¿æŒ 8-bit åƒç´ é£æ ¼çš„è§†è§‰ä¸€è‡´æ€§
- ç¡®ä¿å“åº”å¼è®¾è®¡ï¼ˆç§»åŠ¨ç«¯ä¼˜å…ˆï¼‰
- ä¼˜åŒ– PWA ä½“éªŒï¼ˆç¦»çº¿åŠŸèƒ½ã€æ¨é€é€šçŸ¥ï¼‰
- ä¿æŒæµç•…çš„ç”¨æˆ·äº¤äº’å’ŒåŠ¨ç”»æ•ˆæœ
- éµå¾ªç°ä»£ Web å¼€å‘æœ€ä½³å®è·µ

ğŸ”§ å¼€å‘æŒ‡å¯¼ï¼š
1. æ–°åŠŸèƒ½å¼€å‘æ—¶ä¼˜å…ˆè€ƒè™‘ç”¨æˆ·ä½“éªŒ
2. ä¿æŒä»£ç ç®€æ´ã€å¯ç»´æŠ¤
3. ç¡®ä¿ PWA åŠŸèƒ½å®Œæ•´æ€§
4. ä¼˜åŒ–æ€§èƒ½å’ŒåŠ è½½é€Ÿåº¦
5. ä¿æŒåƒç´ é£æ ¼çš„ç¾å­¦ä¸€è‡´æ€§

ğŸ“‹ å¸¸è§ä»»åŠ¡ï¼š
- æ·»åŠ æ–°çš„å¾…åŠäº‹é¡¹åŠŸèƒ½ï¼ˆåˆ†ç±»ã€æ ‡ç­¾ã€ä¼˜å…ˆçº§ï¼‰
- ä¼˜åŒ–åƒç´ é£æ ¼çš„ UI ç»„ä»¶å’ŒåŠ¨ç”»
- æ”¹è¿› PWA ç¦»çº¿åŠŸèƒ½å’Œæ€§èƒ½
- API æ¥å£å¼€å‘å’Œæ•°æ®åº“è®¾è®¡
- éƒ¨ç½²é…ç½®å’Œ CI/CD ä¼˜åŒ–

å½“å¤„ç†ä»£ç æ—¶ï¼Œè¯·ï¼š
1. åˆ†æç°æœ‰ä»£ç ç»“æ„å’Œè®¾è®¡æ¨¡å¼
2. ä¿æŒåƒç´ é£æ ¼å’Œ PWA ç‰¹æ€§
3. ç¡®ä¿ä»£ç è´¨é‡å’Œæ€§èƒ½
4. æä¾›æ¸…æ™°çš„å‰åç«¯äº¤äº’æ–¹æ¡ˆ
5. è€ƒè™‘ç§»åŠ¨ç«¯å…¼å®¹æ€§å’Œå¯è®¿é—®æ€§"

          # å¼€å‘ç¯å¢ƒé…ç½®
          settings: |
            {
              "env": {
                "PYTHONPATH": "/github/workspace",
                "FLASK_ENV": "development",
                "NODE_ENV": "test"
              }
            }
